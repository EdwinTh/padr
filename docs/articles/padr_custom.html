<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom thickening and padding • padr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Custom thickening and padding">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">padr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/padr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/padr_custom.html">Custom thickening and padding</a>
    </li>
    <li>
      <a href="../articles/padr_implementation.html">Implementation Information of `padr`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EdwinTh/padr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Custom thickening and padding</h1>
                        <h4 class="author">Edwn Thoen</h4>
            
            <h4 class="date">2019-08-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EdwinTh/padr/blob/master/vignettes/padr_custom.Rmd"><code>vignettes/padr_custom.Rmd</code></a></small>
      <div class="hidden name"><code>padr_custom.Rmd</code></div>

    </div>

    
    
<p>This vignette assumes the reader has read the <a href="https://CRAN.R-project.org/package=padr">Introduction to <code>padr</code> vignette</a>. These functions are introduced in version 0.4.0 of the package and should be considered experimental for the moment.</p>
<p><code>thicken</code> creates evenly spaced intervals to which observations can be aggregated. <code>pad</code> subsequently checks for missing observations and inserts records where needed. This procedure can be largely automated because of the assumption of an evenly spaced interval. However, the functions can’t deliver when asymmetry between the datetime points is desired. This might occur when observations are frequent during some moments, and sparse during others. For instance daily hours vs night periods, or working days vs weekends. We might want to perform a single analysis where the datetime spaces between observations are of different lengths.</p>
<p>Lets have a look at all the vehicle incidents in the <code>emergency</code> dataset. Say you want to monitor the trends of number of accidents in the second quarter of 2016. You choose a three hour interval to do the analysis.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(padr); <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr); <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">veh_acc &lt;-<span class="st"> </span>emergency <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(title <span class="op">==</span><span class="st"> "Traffic: VEHICLE ACCIDENT -"</span>,</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">         lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span>(time_stamp) <span class="op">%in%</span><span class="st"> </span><span class="dv">4</span><span class="op">:</span><span class="dv">6</span>) </a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">veh_acc_line_plot &lt;-<span class="st"> </span><span class="cf">function</span>(padded_df,</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">                              <span class="dt">units_to_last =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  padded_df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/fill_by_value.html">fill_by_value</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/thicken.html">thicken</a></span>(<span class="st">"day"</span>, <span class="st">"day"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">interval =</span> <span class="kw"><a href="../reference/format_interval.html">format_interval</a></span>(day_hour, <span class="st">"%H"</span>, <span class="dt">sep =</span> <span class="st">"-"</span> , </a>
<a class="sourceLine" id="cb1-12" data-line-number="12">                                    <span class="dt">units_to_last =</span> units_to_last)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(day, n)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span>interval) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() </a>
<a class="sourceLine" id="cb1-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">veh_acc <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="../reference/thicken.html">thicken</a></span>(<span class="st">"3 hour"</span>, <span class="st">"day_hour"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(day_hour) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="../reference/pad.html">pad</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="st">  </span><span class="kw">veh_acc_line_plot</span>()</a></code></pre></div>
<p><img src="padr_custom_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>Accidents are more common around rush hours. During nightly hours there are hardly any accidents, and also in the daytime the number drops slightly. We would rather aggregate this to morning rush hour, day time, evening rush hour, and night time.</p>
<div id="preparing-the-spanning" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-the-spanning" class="anchor"></a>Preparing the spanning</h2>
<p><code>thicken</code>’s internal work horse is a spanning function. It takes the datetime variable and spans a datetime variable of the desired interval around it. When you want your own asymmetric intervals, you have to build the spanning variable yourself. To help with that, the functions <code>span_around</code> and <code>subset_span</code> are provided. <code>span_around</code> is a wrapper around the internal <code>span</code> function. It will return a spanning with an evenly spaced interval. Of course you can also create this yourself. <code>span_date</code> and <code>span_time</code> are convenient wrappers around <code>seq.Date</code> and <code>seq.POSIXt</code> for manual spanning. Next, to create an asymmetrical spanning, apply <code>subset_span</code> on the evenly spaced span. Together with a list that describes the pattern of points that should be retained.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">veh_acc_span &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/span_around.html">span_around</a></span>(veh_acc<span class="op">$</span>time_stamp, <span class="dt">interval =</span> <span class="st">"hour"</span>, <span class="dt">start_shift =</span> <span class="st">"7 hour"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/subset_span.html">subset_span</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">hour =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">16</span>, <span class="dv">19</span>)))</a></code></pre></div>
<p>Note that the argument <code>start_shift</code> is used. This will add an extra time period before the first observation in the datetime variable. We do this to ensure that spanning is still fully around the datetime variable after subsetting. The argument <code>end_shift</code> is by default equal to <code>start_shift</code>. So we have set this to 7 hours as well in the example.</p>
</div>
<div id="thickening-and-padding" class="section level2">
<h2 class="hasAnchor">
<a href="#thickening-and-padding" class="anchor"></a>Thickening and padding</h2>
<p>The <code>thicken_cust</code> and <code>pad_cust</code> functions both take the spanned object as an argument. <code>thicken_cust</code> will assign each observation to the closest value in the spanned object. Note that <code>thicken_cust</code> only does round down, whereas in the regular <code>thicken</code> there is also the option to round up. This seems the mostly chooses option in the regular <code>thicken</code>, the argument was omitted from <code>thicken_cust</code> for simplicity. <code>pad_cust</code> also needs the spanned object, because it can no longer infer which observations are lacking from the datetime variable. By default, <code>pad_cust</code> drops the last value in the spanned object. If the original spanning was around the datetime variable, leaving the last value in would create an empty record after all the observations.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">veh_acc_cust &lt;-<span class="st"> </span>veh_acc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/thicken_cust.html">thicken_cust</a></span>(<span class="dt">spanned =</span> veh_acc_span, <span class="dt">colname =</span> <span class="st">"day_hour"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(day_hour) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/pad_cust.html">pad_cust</a></span>(veh_acc_span)</a></code></pre></div>
<p>Now we have our data aggregated to an asymmetric spanning, we can rebuild the plot.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">veh_acc_line_plot</span>(veh_acc_cust, <span class="dt">units_to_last =</span> <span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="dv">3600</span>)</a></code></pre></div>
<p><img src="padr_custom_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>And there we have it, we have aggregated and formatted our data to asymmetric intervals.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preparing-the-spanning">Preparing the spanning</a></li>
      <li><a href="#thickening-and-padding">Thickening and padding</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edwin Thoen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
